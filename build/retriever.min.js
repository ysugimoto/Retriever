!function(a){function b(a){this.tpl=a.split(""),this.size=a.length,this.idx=0,this.line=1,this.leftDelimiter="{{",this.rightDelimiter="}}",this.compiledTemplate=null}b.Helpers={},b.make=function(a){return new b(a)},b.addHelper=function(a,c){b.Helpers[a]=c},b.removeHelper=function(a){a in b.Helpers&&delete b.Helpers[a]},b.prototype.escapeMap={"<":"&lt;",">":"&gt:",'"':"&quot;","'":"&apos;"},b.prototype._escape=function(a){if(null===a||void 0===a)return"";var b=this.escapeMap,c=function(a){return b[a]};return a.toString().replace(/([<>"'])/g,c)},b.prototype.parse=function(a){return"function"!=typeof this.compiledTemplate&&(this.compiledTemplate=this._compile()),this.compiledTemplate.apply(this,[a||{},b.Helpers])},b.prototype._compile=function(){for(var a,c,d,e,f,g,h,i,j=["var b = [];"],k=["obj"],l=!1,m="",n="",o=0,p=0;this.idx<this.size;)if(i=this.tpl[this.idx],""!==i&&void 0!==i){if(i+this.tpl[this.idx+1]===this.leftDelimiter)m="",l=!0,""!==n&&(j[j.length]="b[b.length]="+this.quote(n)+";"),n="",this.idx++;else if(i+this.tpl[this.idx+1]===this.rightDelimiter){switch(m.charAt(0)){case"#":if(m=m.slice(1),c=m.split(/\s+/),d=c.slice(1),"function"!=typeof b.Helpers[c[0]])throw new Error('Parse Error: Helper "'+c[0]+'" is not a function.');for(a=d.length,p=0;a>p;++p)d[p]=this.getPrimitiveType(d[p]),null===d[p]?d[p]=k.join(".")+"."+d[p]:"string"==typeof e&&(d[p]=this.quote(d[p]));j[j.length]="b[b.length]=Helper."+b.Helpers[c[0]]+"("+d.join(",")+");";break;case"@":switch(m=m.slice(1),g=!0,"%"===m.charAt(0)&&(m=m.slice(1),g=!1),m){case"data":h=k.join(".");break;case"parent":h=k.slice(0,-1).join(".")}j[j.length]=g?"b[b.length]=this._escape("+h+");":"b[b.length]="+h+";";break;case"%":m=m.slice(1),j[j.length]="b[b.length]="+k.join(".")+"."+m+";";break;case"/":m=m.slice(1),"loop"===m&&(k.pop(),o--),j[j.length]="}";break;default:if(f=/^(if|else\sif|else|for|loop)(?:\s(.+))?/.exec(m),null!==f)switch(f[1]){case"if":j[j.length]="if("+this._parseCondition(f[2],k)+"){";break;case"else if":j[j.length]="}else if("+this._parseCondition(f[2],k)+"){";break;case"else":j[j.length]="}else{";break;case"loop":case"for":j[j.length]="for(var i"+o+"=0,size"+o+"="+k.join(".")+"."+f[2]+".length; i"+o+"<size"+o+"; ++i"+o+"){",k.push(f[2]+"[i"+o++ +"]")}else j[j.length]="b[b.length]=this._esacpe("+k.join(".")+"."+m+");"}l=!1,this.idx++}else l?m+=i:n+=i;"\n"===i&&++this.line,++this.idx}else this.idx++;return j[j.length]="return b.join('');",new Function("obj","Helpers",j.join(""))},b.prototype.quote=function(a){return a=a.replace("\n","\\n").replace("	","\\t").replace("\r","\\r").replace("'","'"),"'"+a+"'"},b.prototype._parseCondition=function(a,b){for(var c,d,e=a.replace(/([><=!&\|\/\-\+\*]{,3}?)/g," $1 "),f=e.split(" "),g=f.length,h=0,i=[];g>h;++h)""!==f[h]&&(c=f[h].trim(),/^[><=!&\|\/\-\+\*]{1,3}$/.test(c)?i[i.length]=c:(d=this.getPrimitiveType(c),null===d?i[i.length]=b.join(".")+"."+c:"number"==typeof d?i[i.length]=d:"string"==typeof d&&(i[i.length]=this.quote(d))));return i.join(" ")},b.prototype.getPrimitiveType=function(a){var b;return null!==(b=/^['"](.+?)['"]$/.exec(a))?b[1]:null!==(b=/^([0-9\.]+)$/.exec(a))?-1!==b[1].indexOf(".")?parseFloat(b[1]):parseInt(b[1],10):null},a.Retriever=b}(this);