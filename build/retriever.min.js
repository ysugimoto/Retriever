!function(a){function b(a){this.template=a,this.leftDelimiter="{{",this.rightDelimiter="}}",this.syntax=["obj"],this.counter=0,this.compiledTemplate=null,this.division=!0}function c(){null===c.rootNode&&c.setRoot()}function d(){this.callbacks={}}function e(){}function f(){}function g(a){this.data=a,this.index=0,this.length=this.data.length||0}function h(a){this.type="boolean",this.data=a}function i(a){this.func=a}function j(a){this.type="number",this.data=a}function k(a){this.data=a,this.key=0}function l(a){this.type="string",this.data=a}function m(){}b.leftDelimiter="{{",b.rightDelimiter="}}",b.setDelimiter=function(a,c){b.leftDelimiter=a||"{{",b.rightDelimiter=c||"}}"},b.Helpers={},b.make=function(a){return new b(a)},b.addHelper=function(a,c){b.Helpers[a]=c},b.addHelperObject=function(a){var c;for(c in a)a.hasOwnProperty(c)&&(b.Helpers[c]=a[c])},b.prototype._escape=function(a){return null===a||void 0===a?"":(a+"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},b.prototype.parse=function(a){return"function"!=typeof this.compiledTemplate&&this.compile(),this.compiledTemplate(a||{},b.Helpers,this._escape,"")},b.prototype.compile=function(){for(var a,c,d=new RegExp(b.leftDelimiter+"([/#@%])?(.+?)"+b.rightDelimiter,"g"),e=[],f=0,g=0;null!==(c=d.exec(this.template));)switch(a=this.template.slice(f,c.index),a&&!/^[\r\n\s]+$/.test(a)&&(e[e.length]=g>0?this.getPrefix()+this.quote(a.replace(/^[\n|\r|\s|\t]+|[\n|\r|\t|\s]+$/g,"")):this.getPrefix()+this.quote(a)),f=d.lastIndex,c[1]){case"#":e[e.length]=this.getPrefix()+this._compileHelper(c[2]);break;case"@":v=this._compileReservedVars(c[2]),v&&(e[e.length]=this.getPrefix()+v);break;case"%":e[e.length]=this.getPrefix()+this.syntax.join(".")+"."+c[2];break;case"/":"loop"===c[2]&&(this.syntax.pop(),this.counter--),e[e.length]="}",this.division=!0,g--;break;default:v=this._compileBuiltInControl(c[2]),v&&(e[e.length]=v),/^(loop|if)/.test(c[2])&&g++}return f<this.template.length&&(e[e.length]=this.getPrefix()+this.quote(this.template.slice(f))),e[e.length]=";return b;",this.compiledTemplate=new Function("obj","Helper","_e","b",e.join("")),this},b.prototype._compileHelper=function(a){var c,d=a.split(/\s+/),e=d.shift(),f=d.length,g=0;if("function"!=typeof b.Helpers[e])throw new Error('Parse Error: Helper "'+e+'" is undefined or not a function.');for(g=0;f>g;++g)c=this.getPrimitiveType(d[g]),null===c?d[g]=this.syntax.join(".")+"."+d[g]:"string"==typeof c?d[g]=this.quote(c):"number"==typeof c&&(d[g]=c);return"Helper."+e+"("+d.join(",")+")"},b.prototype._compileReservedVars=function(a){var b,c,d=!0;if("%"===a[0]&&(a=a.slice(1),d=!1),c=/^(data|index|parent)(.+)?/.exec(a),null!==c){switch(c[1]){case"data":b=this.syntax.join(".")+(c[2]||"");break;case"parent":b=this.syntax.slice(0,-1).join(".")+(c[2]||"");break;case"index":d=!1,b="i"+(this.counter-1);break;default:return}return d?"_e("+b+")":b}},b.prototype._compileBuiltInControl=function(a){var b,c,d=/^(if|else\sif|else|for|loop)(?:\s(.+))?/.exec(a);if(null===d)return this.getPrefix()+"_e("+this.syntax.join(".")+"."+a+")";switch(this.division=!0,d[1]){case"if":return";if("+this._parseCondition(d[2])+"){";case"else if":return"}else if("+this._parseCondition(d[2])+"){";case"else":return"}else{";case"loop":case"for":return c=this.counter,b=";for(var i"+c+"=0,size"+c+"=("+this.syntax.join(".")+"."+d[2]+"||[]).length; i"+c+"<size"+c+"; ++i"+c+"){",this.syntax[this.syntax.length]=d[2]+"[i"+this.counter++ +"]",b}},b.prototype.quote=function(a){return a=a.replace(/\\/g,"\\\\\\").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[']/g,"\\'"),"'"+a+"'"},b.prototype._parseCondition=function(a){for(var b,c,d=a.replace(/(!|>=?|<=?|={2,3}|[^\+]\+|[^\-]\-|\*|&{2}|\|{2})/g," $1 "),e=d.split(/\s+/),f=e.length,g=0,h=[];f>g;++g)b=e[g],/^(!|>=?|<=?|={1,3}|\+|\-|\*|&{2}|\|{2})$/.test(b)?h[h.length]=b:(c=this.getPrimitiveType(b),null===c?h[h.length]=this.syntax.join(".")+"."+b:"number"==typeof c?h[h.length]=c:"string"==typeof c&&(h[h.length]=this.quote(c)));return h.join(" ")},b.prototype.getPrimitiveType=function(a){var b;return null!==(b=/^['"](.+?)['"]$/.exec(a))?b[1]:null!==(b=/^([0-9\.]+)$/.exec(a))?-1!==b[1].indexOf(".")?parseFloat(b[1]):parseInt(b[1],10):null},b.prototype.getPrefix=function(){var a="+";return this.division===!0&&(a="b+=",this.division=!1),a},function(a){var b=document.createElement("style");b.type="text/css",b.innerText='@chatset "UTF-8";[data-bind-show] {display: none !important;}',a.insertBefore(b,a.firstChild)}(document.head||document.getElementsByTagName("head")[0]),c.setRoot=function(a){var b=a||document;c.factory(b),c.rootNode=b},c.factory=function(a,b){for(var d,e=a.querySelectorAll("[data-bind-name]"),f=e.length,g=0;f>g;++g)d=c.View.make(e[g],b);c.View.filter()},c.subscribers={},c.rootNode=null,c.pubsubID=0,c.customEventMap={keyenter:"keydown"},c.subscribe=function(a){c.Model.prototype.__observe===a.__observe&&(c.subscribers[a.getName()]=a)},c.listen=function(){var a=[];return function(b){-1===a.indexOf(b)&&(b in c.customEventMap&&(b=c.customEventMap[b],console.log(b+" mapped")),document.addEventListener(b,c.handleEvent),a.push(b))}}(),c.observe=function(a){return a instanceof Array?new c.Observer.Array(a):"[object Object]"===Object.prototype.toString.call(a)?new c.Observer.Object(a):"function"==typeof a?new c.Observer.Computed(a):"string"==typeof a?new c.Observer.String(a):"number"==typeof a?new c.Observer.Number(a):"boolean"==typeof a?new c.Observer.Boolean(a):new c.Observer.Primitive(a)},c.handleEvent=function(a){var b,d,e,f=a.target;for(1!==f.nodeType&&(f=f.parentNode);f&&f!==document;){if(b=f.getAttribute("data-bind-event")||"",d=f.__rtvid,d&&null!==(e=c.View.getByID(d))){if("handleEvent"in e){if(e.handleEvent(a)===!0)break}else if(-1!==(","+b+",").indexOf(","+a.type+","))break;e=void 0}f=f.parentNode}e&&e.bindModel&&(c.pubsubID++,e.handler?e.bindModel.update(e.handler,f.value||f.innerHTML):e.bindModel.update(e.name,f.value||f.innerHTML))},d.prototype.implement=function(a){return a.prototype=new d,a},d.prototype.on=function(a,b){a in this.callbacks||(this.callbacks[a]=[]),this.callbacks[a].push([b,0])},d.prototype.once=function(a,b){a in this.callbacks||(this.callbacks[a]=[]),this.callbacks[a].push([b,1])},d.prototype.off=function(a,b){if(a in this.callbacks){if(!b)return void delete this.callbacks[a];for(var c=this.callbacks[a].length,d=0;c>d;++d)this.callbacks[a][d][0]===b&&this.callbacks[a].splice(d--,1)}},d.prototype.trigger=function(a,b){if(a in this.callbacks)for(var c=this.callbacks[a].length,d=0;c>d;++d)this.callbacks[a][d][0]({data:b}),this.callbacks[a][d][1]>0&&this.off(a,this.callbacks[d][0])},c.Event=new d,c.Model=e,e.extend=function(a,b){var c=b||{},d=function(){"function"==typeof b?c.apply(this,arguments):Object.keys(c).forEach(function(a){this[a]=c[a]}.bind(this)),this.name=a,this._observe()};return d.prototype=new e,"function"==typeof c&&Object.keys(c).forEach(function(a){d.prototype[a]=c.prototype[a]}),d},e.prototype._observe=function(a){c();var b=Object.keys(this).filter(function(a){return 0!==a.indexOf("-")}),d=this;b.forEach(function(b){if(d[b]instanceof c.Observer)d[b].initialize(d.name,b,d),d[b].attachViews(b,d,a),d[b].chainView();else if("function"==typeof d[b]){var e=c.View.get(d.name+"."+b),f=c.View.get("*."+b);e.concat(f).forEach(function(a){a.bindModel=d})}})},e.prototype.getName=function(){return this.name},e.prototype.update=function(a,b){this.hasOwnProperty(a)&&(this[a]instanceof c.Observer?this[a].trigger("update",b):"function"==typeof this[a]&&this[a](b),this.bindUpdate(a),0===--c.pubsubID&&c.Event.trigger("updatefinish"))},e.prototype.bindUpdate=function(a){Object.keys(this).forEach(function(b){b!==a&&this[b]instanceof c.Observer.Computed&&this[b].update()}.bind(this))},c.Observer=f,f.prototype=new d,f.prototype.initialize=function(a,b,d){this.signature=[a,b],this.model=d,this.bindModel=null;var e=this;this.__updated=!1,this.bindViews=[],this.on("update",function(a){e.__updated===!1&&(e.__updated=!0,e.set(a.data))}),c.Event.on("updatefinish",function(){e.__updated=!1})},f.prototype.attachViews=function(a,b,d){var e,f=(d||document).querySelectorAll('[data-bind-name="'+a+'"]'),g=f.length,h=0;for(this.bindViews=[];g>h;++h)e=c.View.make(f[h],b),this.bindViews.push(e),e.bindModel=b},f.prototype.get=function(){return this.data},f.prototype.set=function(a){if(this.type&&typeof a!==this.type)throw new Error("TypeError: Observe value must be a "+this.type);this.data=a,c.pubsubID++,this.chainView()},f.prototype.update=function(a){if(void 0!==a&&this.type&&typeof a!==this.type)throw new Error("TypeError: Observe value must be a "+this.type);this.data=a},f.prototype.chainView=function(){var a=this.get();this.bindViews.forEach(function(b){"function"==typeof b.valueMode?b.valueMode(a):b.node[b.valueMode]=a,"function"==typeof b.expression&&b.expression(b.bindModel)})},c.Observer.Array=g,g.prototype=new c.Observer,g.prototype.initialize=function(a,b){c.Observer.prototype.initialize.call(this),this.signature=[a,b]},g.prototype.get=function(){return this.data[this.index]},g.prototype.getAll=function(){return this.data},g.prototype.set=function(a){this.index=a,c.pubsubID++,this.chainView()},g.prototype.update=function(a){this.index=a},g.prototype.push=function(){return Array.prototype.push.apply(this.data,arguments),this.length=this.data.length,this.chainView(),this.length},g.prototype.unshift=function(){Array.prototype.unshift.apply(this.data,arguments),this.length=this.data.length,this.chainView()},g.prototype.pop=function(){var a=this.data.pop();return this.length=this.data.length,this.chainView(),a},g.prototype.shift=function(){var a=this.data.shift();return this.length=this.data.length,this.chainView(),a},g.prototype.forEach=function(a){var b=this.data;b.forEach(a),this.length=b.length,this.chainView()},g.prototype.map=function(a){var b=this.data;return this.data=b.map(a),this.length=b.length,this.chainView(),this.data},g.prototype.filter=function(a){var b=this.data;return this.data=b.filter(a),this.length=b.length,this.chainView(),this.data},g.prototype.chainView=function(){var a=this.getAll();this.bindViews&&this.bindViews.forEach(function(b){null!==b.template&&a.forEach(function(a,c){b.addSubView(a,c)}),null!==b.expression&&b.expression(b.bindModel)})},c.Observer.Boolean=h,h.prototype=new c.Observer,h.prototype.initialize=function(a,b){this.signature=[a,b],c.Observer.prototype.initialize.call(this)},c.Observer.Computed=i,i.prototype=new c.Observer,i.prototype.initialize=function(a,b,d){c.Observer.prototype.initialize.call(this),this.signature=[a,b],this.model=d},i.prototype.get=function(){return this.func.call(this.model)},i.prototype.set=function(){var a=this.func.call(this.model);void 0!==a&&(this.data=a,c.pubsubID++,this.chainView(a))},i.prototype.update=function(){var a=this.func.call(this.model);void 0!==a&&(this.data=a,this.chainView(a))},c.Observer.Number=DataBind_Observer_Primitive,j.prototype=new c.Observer,j.prototype.initialize=function(a,b,d){c.Observer.prototype.initialize.call(this),this.signature=[a,b],this.model=d},c.Observer.Object=DataBind_Observer_Iterator,k.prototype=new c.Observer,k.prototype.initialize=function(a,b){c.Observer.prototype.initialize.call(this),this.signature=[a,b]},k.prototype.get=function(){return this.data[this.key]},k.prototype.getAll=function(){return this.data},k.prototype.set=function(a){this.key=a,c.pubsubID++,this.chainView()},k.prototype.update=function(a){this.key=a},k.prototype.add=function(a,b){this.data[a]=b,this.chainView()},k.prototype.remove=function(a){a in this.data&&delete this.data[a],this.chainView()},k.prototype.each=function(a){var b=this.data;Object.keys.forEach(function(c){a.apply(b,[b[c],c])}),this.data=b,this.chainView()},k.prototype.map=function(a){var b=this.data;Object.keys.foreach(function(c){b[c]=a.apply(b,[b[c],c])}),this.data=b,this.chainView()},k.prototype.filter=function(a){var b=this.data;Object.keys.foreach(function(c){a.apply(b,[b[c],c])===!1&&delete b[c]}),this.data=b,this.chainView()},k.prototype.chainView=function(){var a=this.getAll();this.bindViews.forEach(function(b){null!==b.template&&Object.keys(a).forEach(function(c){b.addSubView(a[c],c)}),null!==b.expression&&b.expression()})},c.Observer.String=l,l.prototype=new c.Observer,l.prototype.initialize=function(a,b){c.Observer.prototype.initialize.call(this),this.signature=[a,b]},c.View=m,m.ID=0,m.factory={signatures:{},ids:{}},m.prototype=new c.Observer,m.make=function(a,b){var d,e,f=m.getByID(a.__rtvid||0);return f?f:(d=a.tagName,e=d.charAt(0)+d.slice(1).toLowerCase(),f=e in c.View?new c.View[e]:new c.View,f.initialize(a,b),f)},m.extend=function(a){var b=function(){"function"==typeof a?a.call(this):"[object Object]"===Object.prototype.toString.call(a)&&Object.keys(a).forEach(function(b){this[b]=a[b]}.bind(this))};return b.prototype=new m,b},m.get=function(a){return m.factory.signatures[a]||[]},m.getByID=function(a){return m.factory.ids[a]||null},m.exists=function(a){var b=a.__rtvid||0;return m.factory.ids[b]&&m.ids[b].node===a},m.filter=function(){Object.keys(m.factory.signatures).forEach(function(a){for(var b=m.factory.signatures[a],c=b.length,d=0,e=[];c>d;++d)null!==b[d].node.parentNode&&(e[e.length]=b[d]);m.factory.signatures[a]=e}),Object.keys(m.factory.ids).forEach(function(a){var b=m.factory.ids[a];null===b.node.parentNode&&delete m.factory.ids[a]})},m.prototype.initialize=function(a,d){var e,f,g,h,i=a.getAttribute("data-bind-event"),j=this,k=-1;if(this.expression=null,this.template=null,this.parentView=null,this.node=a,this.subViews={},this.eventName=i||"change",this.eventOnly=!!i,this.signature=a.getAttribute("data-bind-name").split("."),this.__updated=!1,this.id=this.node.__rtvid=++m.ID,c.listen(this.eventName),this.on("update",function(a){j.__updated===!1&&(j.__updated=!0,j.set(a.data))}),c.Event.on("updatefinish",function(){j.__updated=!1}),1===this.signature.length&&this.signature.unshift("*"),this.name=this.signature[this.signature.length-1],this.handler=this.node.getAttribute("data-bind-handler"),this.valueMode=this.node.getAttribute("data-bind-prop")||this.valueMode||"innerHTML",this.node.hasAttribute("data-bind-attr")&&(this.valueMode=function(){return function(a){j.node.setAttribute(atrr,a)}}(this.node.getAttribute("data-bind-attr"))),d)this.bindModel=d;else for(h=Object.keys(c.subscribers);h[++k];)if(this.signature[0]===h[k]||"*"===this.signature[0]){this.bindModel=c.subscribers[h[k]];break}this.eventOnly===!1&&this.node.setAttribute("data-bind-event",this.eventName),this.node.hasAttribute("data-bind-each")&&(this.template=b.make(this.node.innerHTML).compile(),this.node.innerHTML=""),this.node.hasAttribute("data-bind-show")&&(f=this.node.getAttribute("data-bind-show"),e=new Function("return "+f+";"),this.expression=function(a){return function(b){return b&&e.call(b)===!0?void a.node.removeAttribute("data-bind-show"):void a.node.setAttribute("data-bind-show",f)}}(this)),m.exists(a)||(g=this.signature.join("."),g in m.factory.signatures||(m.factory.signatures[g]=[]),m.factory.signatures[g].push(this),m.factory.ids[this.id]=this)},m.prototype.getNode=function(){return this.node},m.prototype.getSignature=function(){return this.signature.join(".")},m.prototype.isEventHandler=function(){return this.eventOnly},m.prototype.addSubView=function(a,b){var d,e=document.createDocumentFragment();if(!(b in this.subViews)){for(d=document.createElement("div"),d.innerHTML=this.template.parse(a),c.factory(d,a),a instanceof c.Model&&a._observe(d);d.firstChild;)e.appendChild(d.firstChild);this.subViews[b]=e,this.node.appendChild(e)}};var n=c.View.extend({valueMode:"value"});c.View.Input=n,n.prototype.handleEvent=function(a){return"keyenter"===this.eventName?13==a.keyCode?!0:!1:-1!==(","+this.eventName+",").indexOf(","+a.type+",")};var o=c.View.extend({valueMode:"value"});c.View.Select=o,o.prototype.addSubView=function(a){for(var b,c=this.node;c.firstChild;)c.removeChild(c.firstChild);a instanceof Array?a.forEach(function(a,d){b=document.createElement("option"),b.value=d,b.appendChild(document.createTextNode(a)),c.appendChild(b)}):Object.keys(a).forEach(function(d){b=document.createElement("option"),b.value=d,b.appendChild(document.createTextNode(a[d])),c.appendChild(b)})};var p=c.View.extend({valueMode:"value"});c.View.Textarea=p,p.prototype.handleEvent=function(a){return"keyenter"===this.eventType?13==a.keyCode:!0},a.Retriever=b,a.DataBind=c}(this);