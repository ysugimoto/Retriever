!function(a){function b(a){this.template=a,this.leftDelimiter="{{",this.rightDelimiter="}}",this.syntax=["obj"],this.counter=0,this.compiledTemplate=null,this.division=!0}function c(){}function d(a,b){var c=function(){"function"==typeof b?b.call(this):Object.keys(b).forEach(function(a){this[a]=b[a]}.bind(this)),this.__observe(a)};return"function"==typeof b&&(c.prototype=b.prototype),Object.keys(d.prototype).forEach(function(a){c.prototype[a]=d.prototype[a]}),c}function e(){}function f(){this.func=arguments[2],this.model=arguments[3],this.initialize(arguments[0],arguments[1])}function g(){this.initialize.apply(this,arguments)}function h(a){var b=a.getAttribute("data-bind-event");this.node=a,this.eventName=b||"change",this.eventOnly=!!b,this.signature=a.getAttribute("data-bind-name").split("."),this.id=this.node.__rtvid=++c.viewID,this.initialize()}b.leftDelimiter="{{",b.rightDelimiter="}}",b.setDelimiter=function(a,c){b.leftDelimiter=a||"{{",b.rightDelimiter=c||"}}"},b.Helpers={},b.make=function(a){return new b(a)},b.addHelper=function(a,c){b.Helpers[a]=c},b.addHelperObject=function(a){var c;for(c in a)a.hasOwnProperty(c)&&(b.Helpers[c]=a[c])},b.prototype._escape=function(a){return null===a||void 0===a?"":(a+"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},b.prototype.parse=function(a){return"function"!=typeof this.compiledTemplate&&this.compile(),this.compiledTemplate(a||{},b.Helpers,this._escape,"")},b.prototype.compile=function(){for(var a,c,d=new RegExp(b.leftDelimiter+"([/#@%])?(.+?)"+b.rightDelimiter,"g"),e=[],f=0,g=0;null!==(c=d.exec(this.template));)switch(a=this.template.slice(f,c.index),a&&!/^[\r\n\s]+$/.test(a)&&(e[e.length]=g>0?this.getPrefix()+this.quote(a.replace(/^[\n|\r|\s|\t]+|[\n|\r|\t|\s]+$/g,"")):this.getPrefix()+this.quote(a)),f=d.lastIndex,c[1]){case"#":e[e.length]=this.getPrefix()+this._compileHelper(c[2]);break;case"@":v=this._compileReservedVars(c[2]),v&&(e[e.length]=this.getPrefix()+v);break;case"%":e[e.length]=this.getPrefix()+this.syntax.join(".")+"."+c[2];break;case"/":"loop"===c[2]&&(this.syntax.pop(),this.counter--),e[e.length]="}",this.division=!0,g--;break;default:v=this._compileBuiltInControl(c[2]),v&&(e[e.length]=v),/^(loop|if)/.test(c[2])&&g++}return f<this.template.length&&(e[e.length]=this.getPrefix()+this.quote(this.template.slice(f))),e[e.length]=";return b;",this.compiledTemplate=new Function("obj","Helper","_e","b",e.join("")),this},b.prototype._compileHelper=function(a){var c,d=a.split(/\s+/),e=d.shift(),f=d.length,g=0;if("function"!=typeof b.Helpers[e])throw new Error('Parse Error: Helper "'+e+'" is undefined or not a function.');for(g=0;f>g;++g)c=this.getPrimitiveType(d[g]),null===c?d[g]=this.syntax.join(".")+"."+d[g]:"string"==typeof c?d[g]=this.quote(c):"number"==typeof c&&(d[g]=c);return"Helper."+e+"("+d.join(",")+")"},b.prototype._compileReservedVars=function(a){var b,c,d=!0;if("%"===a[0]&&(a=a.slice(1),d=!1),c=/^(data|index|parent)(.+)?/.exec(a),null!==c){switch(c[1]){case"data":b=this.syntax.join(".")+(c[2]||"");break;case"parent":b=this.syntax.slice(0,-1).join(".")+(c[2]||"");break;case"index":d=!1,b="i"+(this.counter-1);break;default:return}return d?"_e("+b+")":b}},b.prototype._compileBuiltInControl=function(a){var b,c,d=/^(if|else\sif|else|for|loop)(?:\s(.+))?/.exec(a);if(null===d)return this.getPrefix()+"_e("+this.syntax.join(".")+"."+a+")";switch(this.division=!0,d[1]){case"if":return";if("+this._parseCondition(d[2])+"){";case"else if":return"}else if("+this._parseCondition(d[2])+"){";case"else":return"}else{";case"loop":case"for":return c=this.counter,b=";for(var i"+c+"=0,size"+c+"=("+this.syntax.join(".")+"."+d[2]+"||[]).length; i"+c+"<size"+c+"; ++i"+c+"){",this.syntax[this.syntax.length]=d[2]+"[i"+this.counter++ +"]",b}},b.prototype.quote=function(a){return a=a.replace(/\\/g,"\\\\\\").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[']/g,"\\'"),"'"+a+"'"},b.prototype._parseCondition=function(a){for(var b,c,d=a.replace(/(!|>=?|<=?|={2,3}|[^\+]\+|[^\-]\-|\*|&{2}|\|{2})/g," $1 "),e=d.split(/\s+/),f=e.length,g=0,h=[];f>g;++g)b=e[g],/^(!|>=?|<=?|={1,3}|\+|\-|\*|&{2}|\|{2})$/.test(b)?h[h.length]=b:(c=this.getPrimitiveType(b),null===c?h[h.length]=this.syntax.join(".")+"."+b:"number"==typeof c?h[h.length]=c:"string"==typeof c&&(h[h.length]=this.quote(c)));return h.join(" ")},b.prototype.getPrimitiveType=function(a){var b;return null!==(b=/^['"](.+?)['"]$/.exec(a))?b[1]:null!==(b=/^([0-9\.]+)$/.exec(a))?-1!==b[1].indexOf(".")?parseFloat(b[1]):parseInt(b[1],10):null},b.prototype.getPrefix=function(){var a="+";return this.division===!0&&(a="b+=",this.division=!1),a},c.setRoot=function(a){for(var b=a||c.rootNode||document,d=b.querySelectorAll("[data-bind-name]"),e=d.length,f=0,g=[];e>f;++f)g.push(c.View.make(d[f]));g.forEach(function(a){c.addView(a.getSignature(),a)}),["change","click","focus","blur","keydown","keyup"].forEach(function(a){b.addEventListener(a,c.handleEvent)})},c.subscribers={},c.viewFactory={signatures:{},ids:[]},c.viewID=0,c.rootNode=null,c.pubsubID=0,c.publish=function(a,b){c.pubsubID++,Object.keys(this.subscribers).forEach(function(d){(a[0]===d||"*"===a[0])&&c.subscribers[d].update(a[1],b)})},c.subscribe=function(){var a=!1;return function(b){a===!1&&(c.pubsub(),a=!0),c.subscribers[mode.getName()]=b}}(),c.unsubscribe=function(a){a in c.subscribers&&delete c.subscribers[a]},c.handleEvent=function(a){var b,d,e,f=a.target;1!==f.nodeType&&(f=f.parentNode);do{if(b=f.getAttribute("data-bind-event"),d=f.__rtvid,d&&b&&b===a.type&&null!==(e=c.getViewByID(d)))break;f=f.parentNode}while(f!==document.body);console.log(e),e&&c.publish(e.signature,f.value||f.innerHTML)},c.addView=function(a,b){a in c.viewFactory||(c.viewFactory.signatures[a]=[]),c.viewFactory.signatures[a].push(b),c.viewFactory.ids[b.id]=b},c.getView=function(a){return c.viewFactory.signatures[a]||[]},c.getViewByID=function(a){return c.viewFactory.ids[a]||null},c.Model=d,d.extend=function(a,b){return new d(a,b||{})},d.prototype.__observe=function(a){var b=Object.keys(this).filter(function(a){return 0!==a.indexOf("-")});this._updated={},b.forEach(function(b){this[b];switch(typeof this[b]){case"string":case"number":this[b]=new c.Observer.Primitive(a,b,this[b]),this._updated[b]=!1;break;case"function":this[b]=new c.Observer.Computed(a,b,this[b],this),this._updated[b]=!1}}.bind(this)),this.getName=function(){return a}},d.prototype.update=function(a,b){var d;this.hasOwnProperty(a)&&(this._updated[a]===!1&&this[a]instanceof c.Observer.Computed?(this._updated[a]=!0,void 0!==(d=this[a].execute())&&this[a].update(d)):this._updated[a]===!1&&this[a]instanceof c.Observer.Primitive&&(this._updated[a]=!0,this[a].update(b)),Object.keys(this).forEach(function(b){b!==a&&this._updated[b]===!1&&this[b]instanceof c.Observer.Computed&&(this._updated[b]=!0,void 0!==(d=this[b].execute())&&this[b].set(d))}.bind(this)),0===--c.pubsubID&&Object.keys(this._updated).forEach(function(a){this._updated[a]=!1}.bind(this)))},c.Observer=e,e.prototype.initialize=function(a,b,d){this.data=d,this.keep=d,this.signature=[a,b],this instanceof c.Observer.Primitive&&this.update(this.data)},e.prototype.getChainViews=function(a,b){var d=c.getView(a+"."+b),e=c.getView("*."+b);return d.concat(e)},e.prototype.get=function(){return this.data},e.prototype.set=function(a){this.data=a,c.publish(this.signature,a),this.update(a)},e.prototype.update=function(a){var b=this.signature;this.data=a,this.keep=a,this.getChainViews(b[0],b[1]).forEach(function(b){/INPUT|SELECT|TEXTAREA/.test(b.node.tagName)?b.node.value=a:b.node.innerText=a})},c.Observer.Computed=f,f.prototype=new c.Observer,f.prototype.execute=function(){return this.func.call(this.model)},c.Observer.Primitive=g,g.prototype=new c.Observer,c.View=h,h.make=function(a){return new h(a)},h.prototype.initialize=function(){1===this.signature.length&&this.signature.unshift("*")},h.prototype.getNode=function(){return this.node},h.prototype.getSignature=function(){return this.signature.join(".")},h.prototype.isEventHandler=function(){return this.eventOnly},h.prototype.handleEvent=function(){c.publish(this.signature,this.node.value||this.node.innerHTML)},a.Retriever=b,a.DataBind=c}(this);