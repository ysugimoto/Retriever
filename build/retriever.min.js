!function(a){function b(a){this.template=a,this.leftDelimiter="{{",this.rightDelimiter="}}",this.compiled=[],this.syntax=["obj"],this.counter=0,this.compiledTemplate=null}b.leftDelimiter="{{",b.rightDelimiter="}}",b.setDelimiter=function(a,c){b.leftDelimiter=a||"{{",b.rightDelimiter=c||"}}"},b.Helpers={},b.make=function(a){return new b(a)},b.addHelper=function(a,c){b.Helpers[a]=c},b.addHelperObject=function(a){var c;for(c in a)a.hasOwnProperty(c)&&(b.Helpers[c]=a[c])},b.prototype._escape=function(a){if(null===a||void 0===a)return"";var b={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"},c=function(a){return b[a]};return a.toString().replace(/([<>"'])/g,c)},b.prototype.parse=function(a){return"function"!=typeof this.compiledTemplate&&(this.compiledTemplate=this._compile()),this.compiledTemplate.apply(this,[a||{},b.Helpers])},b.prototype._compile=function(){for(var a,c,d=new RegExp(b.leftDelimiter+"([/#@%])?(.+?)"+b.rightDelimiter,"g"),e=["var b=[];"],f=0,g=0;null!==(c=d.exec(this.template));)switch(a=this.template.slice(f,c.index),a&&(e[e.length]=g>0?"b[b.length]="+this.quote(a.replace(/^[\n|\r|\s|\t]+|[\n|\r|\t|\s]+$/g,""))+";":"b[b.length]="+this.quote(a)+";"),f=d.lastIndex,c[1]){case"#":e[e.length]=this._compileHelper(c[2]);break;case"@":v=this._compileReservedVars(c[2]),v&&(e[e.length]=v);break;case"%":e[e.length]="b[b.length]="+this.syntax.join(".")+"."+c[2]+";";break;case"/":"loop"===c[2]&&(this.syntax.pop(),this.counter--),e[e.length]="}",g--;break;default:v=this._compileBuiltInControl(c[2]),v&&(e[e.length]=v),/^(loop|if)/.test(c[2])&&g++}return f<this.template.length&&(e[e.length]="b[b.length]="+this.quote(this.template.slice(f))+";"),e[e.length]='return b.join("");',new Function("obj","Helper",e.join(""))},b.prototype._compileHelper=function(a){var c,d=a.split(/\s+/),e=d.shift(),f=d.length,g=0;if("function"!=typeof b.Helpers[e])throw new Error('Parse Error: Helper "'+e+'" is undefined or not a function.');for(g=0;f>g;++g)c=this.getPrimitiveType(d[g]),null===c?d[g]=this.syntax.join(".")+"."+d[g]:"string"==typeof c?d[g]=this.quote(c):"number"==typeof c&&(d[g]=c);return"b[b.length]=Helper."+e+"("+d.join(",")+");"},b.prototype._compileReservedVars=function(a){var b,c,d=!0;if("%"===a[0]&&(a=a.slice(1),d=!1),c=/^(data|index|parent)(.+)?/.exec(a),null!==c){switch(c[1]){case"data":b=this.syntax.join(".")+(c[2]||"");break;case"parent":b=this.syntax.slice(0,-1).join(".")+(c[2]||"");break;case"index":d=!1,b="i"+(this.counter-1);break;default:return}return d?"b[b.length]=this._escape("+b+");":"b[b.length]="+b+";"}},b.prototype._compileBuiltInControl=function(a){var b,c,d=/^(if|else\sif|else|for|loop)(?:\s(.+))?/.exec(a);if(null===d)return"b[b.length]=this._escape("+this.syntax.join(".")+"."+a+");";switch(d[1]){case"if":return"if("+this._parseCondition(d[2])+"){";case"else if":return"}else if("+this._parseCondition(d[2])+"){";case"else":return"}else{";case"loop":case"for":return c=this.counter,b="for(var i"+c+"=0,size"+c+"=("+this.syntax.join(".")+"."+d[2]+"||[]).length; i"+c+"<size"+c+"; ++i"+c+"){",this.syntax[this.syntax.length]=d[2]+"[i"+this.counter++ +"]",b}},b.prototype.quote=function(a){return a=a.replace(/\\/g,"\\\\\\").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/["]/g,'\\"'),'"'+a+'"'},b.prototype._parseCondition=function(a){for(var b,c,d=a.replace(/(!|>=?|<=?|={2,3}|[^\+]\+|[^\-]\-|\*|&{2}|\|{2})/g," $1 "),e=d.split(/\s+/),f=e.length,g=0,h=[];f>g;++g)b=e[g],/^(!|>=?|<=?|={1,3}|\+|\-|\*|&{2}|\|{2})$/.test(b)?h[h.length]=b:(c=this.getPrimitiveType(b),null===c?h[h.length]=this.syntax.join(".")+"."+b:"number"==typeof c?h[h.length]=c:"string"==typeof c&&(h[h.length]=this.quote(c)));return h.join(" ")},b.prototype.getPrimitiveType=function(a){var b;return null!==(b=/^['"](.+?)['"]$/.exec(a))?b[1]:null!==(b=/^([0-9\.]+)$/.exec(a))?-1!==b[1].indexOf(".")?parseFloat(b[1]):parseInt(b[1],10):null},a.Retriever=b}(this);