<!doctype html><html><head>

<meta charset="UTF-8">
<title>DataBind test</title>
<link rel="stylesheet" type="text/css" href="style.css">
<script src="retriever.js"></script>

</head>

<body>
    <div id="todoapp">
        <header>
            <h1>Todos by Retriever.js</h1>
            <input id="new-todo" type="text" placeholder="What need to be done?" data-bind-name="inputTitle" data-bind-event="keyenter" data-bind-handler="entered">
        </header>

        <section id="main" style="display:block">
            <div data-bind-name="todos" data-bind-show="this.todos.length > 0">
                <input id="toggle-all" type="checkbox" data-bind-name="checkAll" data-bind-event="change" />
                <label for="toggle-all">Mark all as complete</label>
                <ul id="todo-list" data-bind-name="todos" data-bind-each>
                    <li data-bind-name="state" data-bind-event="dblclick" data-bind-attr="class" data-event-hander="toggleEditMode">
                        <div class="view">
                            <input class="toggle" type="checkbox" data-bind-name="checked" data-bind-prop="checked"  />
                            <label data-bind-name="text">{{text}}</label>
                            <a class="destroy"></a>
                        </div>
                        <input class="edit" type="text" data-bind-name="title" data-bind-name="keydown">
                    </li>
                </ul>
        </section>

        <footer style="display:block">
            <div data-bind-name="todos" data-bind-show="this.todos.length > 0">
                <div class="todo-count"><b data-bind-name="todoCount"></b> items left</div>
                <a id="clear-completed" data-bind-name="clear" data-bind-event="click">
                    Clear <span data-bind-name="countDone"></span>
                </a>
                <br style="clear:both" />
            </div>
        </footer>

<script>
    var ViewModel = DataBind.Model.extend('ViewModel', function() {
        this.inputTitle = DataBind.observe('');
        this.entered = function(value) {
            this.todos.push(new TodoModel(value));
            this.inputTitle.set('');
        };

        this.todos = DataBind.observe([]);
        this.checkAll = function() {
            this.todos.forEach(function(obj) {
                var chk = obj.checked.get();

                obj.checked.set(!chk);
            });
        };
        this.todoCount = DataBind.observe(function() {
            var cnt = 0;
            this.todos.forEach(function(obj) {
                if ( obj.done === false ) {
                    cnt++;
                }
            });

            return cnt;
        });
        this.countDone = DataBind.observe(function() {
            var cnt = 0;
            this.todos.forEach(function(obj) {
                if ( obj.done === true ) {
                    cnt++;
                }
            });

            return cnt;
        });
        this.clear = function() {
            console.log('clear');
        };
    });
    
var TodoModel = DataBind.Model.extend('TodoModel', function(name) {
    this.done    = false;
    this.checked = DataBind.observe(false);
    this.text    = name;
    this.state   = DataBind.observe('');
    this.toggleEditMode = function() {
        var chk = this.checked.get();

        if ( chk === true ) {
            this.state.set('edit');
        } else {
            this.sate.set('');
        }
    };
});

    var model = new ViewModel();




</script>
</body>
</html>
