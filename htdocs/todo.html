<!doctype html><html><head>

<meta charset="UTF-8">
<title>DataBind test</title>
<link rel="stylesheet" type="text/css" href="style.css">
<script src="retriever.js"></script>

</head>

<body>
    <div id="todoapp">
        <header>
            <h1>Todos by Retriever.js</h1>
            <input id="new-todo" type="text" placeholder="What need to be done?" data-bind-name="inputTitle" data-bind-event="keyenter" data-bind-handler="entered">
        </header>

        <section id="main" style="display:block">
            <div data-bind-name="todos" data-bind-show="this.todos.length > 0">
                <input id="toggle-all" type="checkbox" data-bind-name="checkAll" data-bind-event="change" />
                <label for="toggle-all">Mark all as complete</label>
                <ul id="todo-list" data-bind-name="todos" data-bind-each>
                    <li data-bind-name="state" data-bind-event="dblclick" data-bind-attr="class" data-event-hander="toggleEditMode">
                        <div class="view">
                            <input class="toggle" type="checkbox" data-bind-name="checked" data-bind-prop="checked" />
                            <label data-bind-name="text">{{text}}</label>
                            <a class="destroy"></a>
                        </div>
                        <input class="edit" type="text" data-bind-name="title" data-bind-name="keydown">
                    </li>
                </ul>
        </section>

        <footer style="display:block">
            <div data-bind-name="todos" data-bind-show="this.todos.length > 0">
                <div class="todo-count"><b data-bind-name="todoCount"></b> items left</div>
                <a id="clear-completed">
                    Clear <span data-bind-name="countDone"></span>
                </a>
                <br style="clear:both" />
            </div>
        </footer>

<script>
    var ViewModel = DataBind.Model.extend('ViewModel', function() {
        this.inputTitle = DataBind.observe('');
        this.entered = function(value) {
            this.todos.push(new TodoModel(value));
            this.inputTitle.set('');
        };

        this.todos = DataBind.observe([]);
        this.checkAll = function() {
            this.todos.forEach(function(obj) {
                var chk = obj.checked.get();

                obj.checked.set(!chk);
            });
        };
        this.todoCount = DataBind.observe(function() {
            var cnt = 0;
            this.todos.forEach(function(obj) {
                if ( obj.checked.get() === false ) {
                    cnt++;
                }
            });

            return cnt;
        });
        this.countDone = DataBind.observe(function() {
            var str = '';
            var cnt = this.countDoneTodos();

            str += cnt + ' completed item';
            if ( cnt > 1 ) {
                str += 's';
            }
            return str;

        });
        this.countDoneTodos = function() {
            var cnt = 0;
            this.todos.forEach(function(obj) {
                if ( obj.checked.get() === true ) {
                    cnt++;
                }
            });

            return cnt;
        };
        this.clear = function() {
            console.log('clear');
        };
    });
    
var TodoModel = DataBind.Model.extend('TodoModel', function(name) {
    this.checked = DataBind.observe(false);
    this.text    = name;
    this.toggleEditMode = function(value, evt) {
        var chk = this.checked.get();

        console.log(evt, chk);

    };
    this.countDoneText = DataBind.observe(function(value, evt) {
        var cnt = ViewModel.countDoneTodos();
        var link = document.getElementById('clear-completed');

        if ( cnt > 0 ) {
            link.removeAttribute('data-bind-show');
        } else {
            link.setAttribute('data-bind-show', 1);
        }
        ViewModel.countDone.call();
        //ViewModel.countDone.update();
    });
});

    var ViewModel = new ViewModel();




</script>
</body>
</html>
